{"version":3,"file":"static/js/732.d5d9326c.chunk.js","mappings":"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","sources":["pages/DragMobile.jsx","webpack://my-app/./src/pages/scss/drag.module.scss?faa3"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport style from \"./scss/drag.module.scss\";\r\nexport default function Drag() {\r\n  const [isactive, setIsactive] = useState(false);\r\n  let dragging = false;\r\n  let cloneEl = null; // 克隆元素\r\n  let initial = {}; // 初始化数据记录\r\n  let queue = [];\r\n  const imgList = [\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1519389950473-47ba0277781c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8NXx8dGVjaHxlbnwwfHx8fDE2NjIwMjc1MzI&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1525547719571-a2d4ac8945e2?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8N3x8dGVjaHxlbnwwfHx8fDE2NjIwMjc1MzI&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n    {\r\n      src: \"https://images.unsplash.com/photo-1531297484001-80022131f5a1?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMjA3fDB8MXxzZWFyY2h8MXx8dGVjaHxlbnwwfHx8fDE2NjIwMjM2MDQ&ixlib=rb-1.2.1&q=80&w=100\",\r\n    },\r\n  ];\r\n  useEffect(() => {\r\n    document.getElementById(\"list\").addEventListener(\"mousedown\", down);\r\n    document.getElementById(\"list\").addEventListener(\"touchstart\", down);\r\n    document.getElementById(\"content\").addEventListener(\"mousedown\", downCont);\r\n    window.addEventListener(\"mousemove\", move);\r\n    window.addEventListener(\"touchmove\", move);\r\n    document.getElementById(\"content\").addEventListener(\"touchend\", goalUp);\r\n    document.getElementById(\"content\").addEventListener(\"mouseup\", goalUp);\r\n    // 鼠标抬起\r\n    window.addEventListener(\"mouseup\", undoUp);\r\n    window.addEventListener(\"touchend\", undoUp);\r\n    // 鼠标离开了视窗\r\n    document.addEventListener(\"mouseleave\", (e) => {\r\n      end();\r\n    });\r\n    // 用户可能离开了浏览器\r\n    window.onblur = () => {\r\n      end();\r\n    };\r\n  }, []);\r\n  // 结束处理（动画）\r\n  function end() {\r\n    dragging = false;\r\n    if (!cloneEl) {\r\n      return;\r\n    }\r\n    cloneEl.classList.add(\"is_return\");\r\n    changeStyle([\r\n      `left: ${initial.pageX - initial.offsetX}px`,\r\n      `top: ${initial.pageY - initial.offsetY}px`,\r\n      \"transform: scale(1)\",\r\n    ]);\r\n    setTimeout(() => {\r\n      queue.length && queue.shift()();\r\n      cloneEl && cloneEl.remove();\r\n      cloneEl = null;\r\n    }, 300);\r\n  }\r\n  // 按下鼠标\r\n  function down(e) {\r\n    e.preventDefault();\r\n    if (e.target.classList.contains(\"item\") && !cloneEl) {\r\n      // document.getElementById(\"app\").classList.add(\"active\");\r\n     // setIsactive(true);\r\n      // 选中了元素\r\n      cloneEl = e.target.cloneNode(true);\r\n      cloneEl.classList.add(\"flutter\");\r\n      // 模拟一个随机大小的\"原图\"，实际业务中不存在\r\n      const fakeSize = parseInt(100 * randomNum(3, 5));\r\n      // 初始化数据\r\n      init(e, { width: e.target.offsetWidth }, fakeSize, Math.random());\r\n      // 加载\"原图\"\r\n      simulate(cloneEl.src.replace(/w=100/g, \"w=\" + fakeSize), initial.flag);\r\n\r\n      e.target.parentElement.appendChild(cloneEl);\r\n      dragging = true;\r\n      e.target.classList.add(\"hide\"); // 放在最后\r\n      queue.push(() => {\r\n        e.target.classList.remove(\"hide\");\r\n      });\r\n    }\r\n  }\r\n  function downCont(e) {\r\n    e.preventDefault();\r\n    if (e.target.classList.contains(\"item\") && !cloneEl) {\r\n      // document.getElementById(\"app\").classList.add(\"active\");\r\n      setIsactive(true);\r\n      // 选中了元素\r\n      cloneEl = e.target.cloneNode(true);\r\n      cloneEl.classList.add(\"flutter\");\r\n      cloneEl.classList.add(\"cont\");\r\n      // 模拟一个随机大小的\"原图\"，实际业务中不存在\r\n      //const fakeSize = parseInt(100 * randomNum(3, 5));\r\n      const fakeSize = e.target.offsetWidth;\r\n      // 初始化数据\r\n      init(e, { width: e.target.offsetWidth }, fakeSize, Math.random());\r\n      // 加载\"原图\"\r\n      simulate(cloneEl.src.replace(/w=100/g, \"w=\" + fakeSize), initial.flag);\r\n\r\n      e.target.parentElement.appendChild(cloneEl);\r\n      dragging = true;\r\n      e.target.classList.add(\"hide\"); // 放在最后\r\n      queue.push(() => {\r\n        e.target.classList.remove(\"hide\");\r\n        e.target.remove();\r\n      });\r\n    }\r\n  }\r\n  //鼠标移动\r\n  function move(e) {\r\n    console.log(e);\r\n      var x = e.touches[0].pageX;\r\n      var y = e.touches[0].pageY;\r\n    if (dragging && cloneEl) {\r\n      moveFlutter(x - initial.offsetX, y - initial.offsetY, distance(e));\r\n    }\r\n  }\r\n  //到达目的松开\r\n  function goalUp(e) {\r\n    if (e.target.id !== \"content\") {\r\n      const lostX =\r\n        e.x - document.getElementById(\"content\").getBoundingClientRect().left;\r\n      const lostY =\r\n        e.y - document.getElementById(\"content\").getBoundingClientRect().top;\r\n      done(lostX, lostY);\r\n    } else {\r\n      done(e.offsetX, e.offsetY);\r\n    }\r\n  }\r\n  function undoUp(e) {\r\n    dragging = false;\r\n    setIsactive(false);\r\n    setTimeout(() => {\r\n      end();\r\n    }, 10);\r\n  }\r\n  // 完成处理\r\n  function done(x, y) {\r\n    if (!cloneEl) {\r\n      return;\r\n    }\r\n    const newEl = cloneEl.cloneNode(true);\r\n    newEl.classList.remove(\"flutter\");\r\n    newEl.src = cloneEl.getAttribute(\"raw\");\r\n    newEl.style.cssText = `left: ${x - initial.offsetX}px; top: ${\r\n      y - initial.offsetY\r\n    }px;`;\r\n    document.getElementById(\"content\").appendChild(newEl);\r\n    cloneEl.remove();\r\n    cloneEl = null;\r\n    queue.length && queue.shift()();\r\n  }\r\n  // 改变漂浮元素（合并多个操作）\r\n  function moveFlutter(x, y, d = 0) {\r\n    // const scale = null // TODO: 关闭缩放\r\n    const scale = d\r\n      ? initial.width + d <= initial.fakeSize\r\n        ? `transform: scale(${(initial.width + d) / initial.width})`\r\n        : null\r\n      : null;\r\n    let options;\r\n    if (cloneEl.classList.contains(\"cont\")) {//左右侧漂浮元素针对的父元素不同，位置也会不同。\r\n      options = [`left: ${x - 525}px`, `top: ${y - 112}px`];\r\n    } else {\r\n      options = [`left: ${x}px`, `top: ${y}px`];//左侧\r\n    }\r\n    scale && options.push(scale);\r\n    changeStyle(options);\r\n  }\r\n  function changeStyle(arr) {\r\n    const original = cloneEl.style.cssText.split(\";\");\r\n    original.pop();\r\n    cloneEl.style.cssText = original.concat(arr).join(\";\") + \";\";\r\n  }\r\n  // 记录鼠标初始化事件\r\n  function init(e, { width }, fakeSize, flag) {\r\n    initial = { offsetX:e.offsetX, offsetY:e.offsetY, pageX:e.touches[0].pageX, pageY:e.touches[0].pageY, width, fakeSize, flag };\r\n    moveFlutter(e.touches[0].pageX - e.offsetX, e.touches[0].pageY - e.offsetY);\r\n  }\r\n  // 计算两点之间距离\r\n  function distance({ pageX, pageY }) {\r\n    const { pageX: x, pageY: y } = initial;\r\n    const b = pageX - x;\r\n    const a = pageY - y;\r\n    return Math.sqrt(Math.pow(b, 2) + Math.pow(a, 2));\r\n  \r\n  }\r\n  \r\n  // 加载原图通常需要时间，利用缓存来优化卡顿\r\n  function simulate(url, flag) {\r\n    cloneEl.setAttribute(\"raw\", url);\r\n    const image = new Image();\r\n    image.src = url;\r\n    image.onload = function () {\r\n      // 异步任务，克隆节点可能会先被清理\r\n      cloneEl && initial.flag === flag && (cloneEl.src = url);\r\n    };\r\n  }\r\n  function randomNum(n, m) {\r\n    return Math.random() * (m - n) + n;\r\n  }\r\n  return (\r\n    <div\r\n      id=\"app\"\r\n      className={`table-list ${style.drag} ${isactive ? \"active\" : \"\"}`}\r\n    >\r\n      <div className=\"slide\">\r\n        <div id=\"list\" className=\"grid\">\r\n          {imgList.map((v, i) => {\r\n            return <img key={i} className=\"item\" src={v.src} />;\r\n          })}\r\n        </div>\r\n      </div>\r\n      <div id=\"content\"></div>\r\n    </div>\r\n  );\r\n}\r\n","// extracted by mini-css-extract-plugin\nexport default {\"drag\":\"drag_drag__tchl3\"};"],"names":["Drag","useState","isactive","setIsactive","dragging","cloneEl","initial","queue","end","classList","add","changeStyle","pageX","offsetX","pageY","offsetY","setTimeout","length","shift","remove","down","e","preventDefault","target","contains","cloneNode","fakeSize","parseInt","n","m","Math","random","init","width","offsetWidth","simulate","src","replace","flag","parentElement","appendChild","push","downCont","move","console","log","x","touches","y","moveFlutter","b","a","sqrt","pow","distance","goalUp","id","done","document","getElementById","getBoundingClientRect","left","top","undoUp","newEl","getAttribute","style","cssText","options","d","scale","arr","original","split","pop","concat","join","url","setAttribute","image","Image","onload","useEffect","addEventListener","window","onblur","className","map","v","i"],"sourceRoot":""}